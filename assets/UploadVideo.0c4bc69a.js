import{l as e}from"./category.7feefb6e.js";import{u as a}from"./video.1ccd3c39.js";import{c as l,m as o,o as t,n as s,s as r,q as n,N as i,w as u,Z as d,_ as c,$ as m,a0 as p,a1 as g,D as v,a2 as f,x as h,a3 as y,T as w}from"./vendor.986fff3c.js";import{s as b}from"./sleep.d3439312.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.764959f2.js";const _=v("span",null,"上传中...",-1);var x=l({setup(l){const x=y.Component,j=o(),k=ref([]),C=reactive({title:"",file:computed((()=>{var e;return 0===k.value.length?null:null!=(e=k.value[0].file)?e:null})),intro:"",category_id:null}),V=ref(!1),P=ref(0),$=e=>(Array.isArray(e)||(e=[e]),e.some((e=>!e.type.startsWith("image/")))&&w.fail("请上传视频文件"),!0),U=reactive({show:!1,categories:[],selected:null}),W=e=>{U.selected=e[e.length-1],C.category_id=U.selected.id,U.show=!1},A=computed((()=>U.selected?U.selected.name:""));onBeforeMount((async()=>{await(async()=>{let a;try{a=await e()}catch(l){return void console.error(l)}U.categories=a.data})()}));const M=ref(),S=()=>{var e;null==(e=M.value)||e.submit()},T=async()=>{V.value=!0;const e=C.file,l={title:C.title,intro:C.intro,category_id:C.category_id.toString()};try{await a(e,l,(e=>{e.lengthComputable&&(P.value=e.loaded/e.total*99|0)}))}catch(o){return console.error(o),void(V.value=!1)}P.value=100,await nextTick(),await b(500),V.value=!1,w.success("上传成功"),j.back()};return(e,a)=>(t(),s("div",{class:h(e.$style.container)},[r(n(i),{title:"发布视频","left-text":"返回","right-text":"发布",onClickLeft:a[0]||(a[0]=a=>e.$router.back()),onClickRight:S}),r(n(g),{ref:M,onSubmit:T},{default:u((()=>[r(n(d),{modelValue:n(C).intro,"onUpdate:modelValue":a[1]||(a[1]=e=>n(C).intro=e),name:"视频简介",placeholder:"视频简介..."},null,8,["modelValue"]),r(n(d),{name:"video",rules:[{validator:e=>0!==e.length,message:"请选择视频",trigger:"onChange"}]},{input:u((()=>[r(n(c),{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=e=>k.value=e),"before-read":$,accept:"video/*","preview-size":"120px","max-count":1},null,8,["modelValue"])])),_:1},8,["rules"]),r(n(d),{modelValue:n(C).title,"onUpdate:modelValue":a[3]||(a[3]=e=>n(C).title=e),type:"text",name:"标题",label:"标题",placeholder:"请输入视频标题(不少于6个字)",rules:[{validator:e=>6<=e.length,message:"视频标题不少于6个字"}]},null,8,["modelValue","rules"]),r(n(d),{readonly:"",clickable:"",name:"分类","model-value":n(A),label:"分类",placeholder:"选择视频分类",rules:[{validator:e=>0!==e.length,message:"请选择视频分类",trigger:"onChange"}],onClick:a[4]||(a[4]=e=>n(U).show=!0)},null,8,["model-value","rules"]),r(n(m),{show:n(U).show,"onUpdate:show":a[6]||(a[6]=e=>n(U).show=e),position:"bottom"},{default:u((()=>[r(n(p),{"value-key":"name",columns:n(U).categories,onConfirm:W,onCancel:a[5]||(a[5]=e=>n(U).show=!1)},null,8,["columns"])])),_:1},8,["show"])])),_:1},512),r(n(x),{show:V.value,"onUpdate:show":a[7]||(a[7]=e=>V.value=e),"show-confirm-button":!1},{default:u((()=>[v("div",{class:h(e.$style.uploadProgressWrapper)},[_,r(n(f),{class:h(e.$style.uploadProgress),percentage:P.value,"stroke-width":"8"},null,8,["class","percentage"])],2)])),_:1},8,["show"])],2))}});var j={container:"_container_1yb0r_2",uploadProgressWrapper:"_uploadProgressWrapper_1yb0r_7",uploadProgress:"_uploadProgress_1yb0r_7"};(x.__cssModules={}).$style=j;export{x as default};
